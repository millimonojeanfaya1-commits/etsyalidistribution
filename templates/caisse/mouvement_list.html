{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load money %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Mouvements de caisse</h2>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-dark" href="{% url 'caisse:print' %}?{% if date_debut %}date_debut={{ date_debut|date:'Y-m-d' }}&{% endif %}{% if date_fin %}date_fin={{ date_fin|date:'Y-m-d' }}&{% endif %}">
      <i class="fas fa-print me-1"></i> Imprimer
    </a>
    <a class="btn btn-outline-secondary" href="?{% if date_debut %}date_debut={{ date_debut|date:'Y-m-d' }}&{% endif %}{% if date_fin %}date_fin={{ date_fin|date:'Y-m-d' }}&{% endif %}export=csv">
      <i class="fas fa-file-csv me-1"></i> Export CSV
    </a>
    <a class="btn btn-primary" href="{% url 'caisse:create' %}">Nouveau mouvement</a>
  </div>

  
</div>

<form method="get" class="row g-3 align-items-end mb-4">
  <div class="col-md-3">
    <label class="form-label">Date début</label>
    <input type="date" name="date_debut" value="{{ date_debut|date:'Y-m-d' }}" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">Date fin</label>
    <input type="date" name="date_fin" value="{{ date_fin|date:'Y-m-d' }}" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">Totaux période</label>
    <div class="form-control bg-light">
      <span class="text-success">+ {{ total_entree|gnf }} GNF</span>
      <span class="ms-2 text-danger">- {{ total_sortie|gnf }} GNF</span>
      <span class="ms-2 fw-semibold">= {{ solde|gnf }} GNF</span>
    </div>
  </div>
  <div class="col-md-3">
    <button type="submit" class="btn btn-outline-primary"><i class="fas fa-filter me-1"></i>Filtrer</button>
    <a href="." class="btn btn-outline-secondary ms-1">Réinitialiser</a>
  </div>
  
</form>

<div class="row">
  <div class="col-lg-7">
    <div class="card mb-4">
      <div class="card-header">Mouvements</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-bordered mb-0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Libellé</th>
                <th>Montant entrée</th>
                <th>Montant sortie</th>
                <th>Observations</th>
              </tr>
            </thead>
            <tbody>
              {% for m in mouvements %}
              <tr>
                <td>{{ m.date|date:'d/m/Y' }}</td>
                <td>{{ m.libelle }}</td>
                <td class="text-success fw-semibold">{{ m.montant_entree|gnf }} GNF</td>
                <td class="text-danger fw-semibold">{{ m.montant_sortie|gnf }} GNF</td>
                <td>{{ m.observations }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="5" class="text-center">Aucun mouvement</td></tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <th>Total</th>
                <th></th>
                <th class="text-success">{{ total_entree|gnf }} GNF</th>
                <th class="text-danger">{{ total_sortie|gnf }} GNF</th>
                <th>Solde: <span class="fw-bold">{{ solde|gnf }} GNF</span></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card mb-4">
      <div class="card-header">Résumé par jour</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>Jour</th>
                <th class="text-success">Entrées</th>
                <th class="text-danger">Sorties</th>
                <th>Solde</th>
              </tr>
            </thead>
            <tbody>
              {% for r in resume_jour %}
              <tr>
                <td>{{ r.date|date:'d/m/Y' }}</td>
                <td class="text-success">{{ r.entree|gnf }} GNF</td>
                <td class="text-danger">{{ r.sortie|gnf }} GNF</td>
                <td class="fw-semibold">{{ r.solde|gnf }} GNF</td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="text-center">Aucune donnée</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Résumé par mois</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>Mois</th>
                <th class="text-success">Entrées</th>
                <th class="text-danger">Sorties</th>
                <th>Solde</th>
              </tr>
            </thead>
            <tbody>
              {% for r in resume_mois %}
              <tr>
                <td>{{ r.mois|date:'m/Y' }}</td>
                <td class="text-success">{{ r.entree|gnf }} GNF</td>
                <td class="text-danger">{{ r.sortie|gnf }} GNF</td>
                <td class="fw-semibold">{{ r.solde|gnf }} GNF</td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="text-center">Aucune donnée</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
